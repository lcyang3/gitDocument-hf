!function(t){function e(t,e,r,i){var n,o=0,s=0,h=0,r=(r||"(").toString(),i=(i||")").toString();for(n=0;n<t.length;n++){var a=t[n];a.indexOf(r,o)>a.indexOf(i,o)||~a.indexOf(r,o)&&!~a.indexOf(i,o)||!~a.indexOf(r,o)&&~a.indexOf(i,o)?(s=a.indexOf(r,o),h=a.indexOf(i,o),(~s&&!~h||!~s&&~h)&&(t=[t.slice(0,(n||1)+1).join(e)].concat(t.slice((n||1)+1))),o=(h>s?h:s)+1,n=0):o=0}return t}function r(t,e){for(var r,n=0,o="";r=t.substr(n).match(/[^\w\d\- %@&]*\*[^\w\d\- %@&]*/);)n=r.index+r[0].length,r[0]=r[0].replace(/^\*/,"([_.()!\\ %@&a-zA-Z0-9-]+)"),o+=t.substr(0,r.index)+r[0];var s,h,a=(t=o+=t.substr(n)).match(/:([^\/]+)/gi);if(a){h=a.length;for(var c=0;c<h;c++)s=a[c],t="::"===s.slice(0,2)?s.slice(1):t.replace(s,i(s,e))}return t}function i(t,e,r){r=t;for(var i in e)if(e.hasOwnProperty(i)&&(r=e[i](t))!==t)break;return r===t?"([._a-zA-Z0-9-%()]+)":r}function n(t,e,r){if(!t.length)return r();var i=0;!function n(){e(t[i],function(e){e||!1===e?(r(e),r=function(){}):(i+=1)===t.length?r():n()})}()}function o(t){for(var e=[],r=0,i=t.length;r<i;r++)e=e.concat(t[r]);return e}function h(t,e){for(var r=0;r<t.length;r+=1)if(!1===e(t[r],r,t))return}function a(){return""===c.hash||"#"===c.hash}var c=document.location,u={mode:"modern",hash:c.hash,history:!1,check:function(){var t=c.hash;t!=this.hash&&(this.hash=t,this.onHashChanged())},fire:function(){"modern"===this.mode?!0===this.history?window.onpopstate():window.onhashchange():this.onHashChanged()},init:function(t,e){function r(t){for(var e=0,r=f.listeners.length;e<r;e++)f.listeners[e](t)}var i=this;if(this.history=e,f.listeners||(f.listeners=[]),"onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7))!0===this.history?setTimeout(function(){window.onpopstate=r},500):window.onhashchange=r,this.mode="modern";else{var n=document.createElement("iframe");n.id="state-frame",n.style.display="none",document.body.appendChild(n),this.writeFrame(""),"onpropertychange"in document&&"attachEvent"in document&&document.attachEvent("onpropertychange",function(){"location"===event.propertyName&&i.check()}),window.setInterval(function(){i.check()},50),this.onHashChanged=r,this.mode="legacy"}return f.listeners.push(t),this.mode},destroy:function(t){if(f&&f.listeners)for(var e=f.listeners,r=e.length-1;r>=0;r--)e[r]===t&&e.splice(r,1)},setHash:function(t){return"legacy"===this.mode&&this.writeFrame(t),!0===this.history?(window.history.pushState({},document.title,t),this.fire()):c.hash="/"===t[0]?t:"/"+t,this},writeFrame:function(t){var e=document.getElementById("state-frame"),r=e.contentDocument||e.contentWindow.document;r.open(),r.write("<script>_hash = '"+t+"'; onload = parent.listener.syncHash;<script>"),r.close()},syncHash:function(){var t=this._hash;return t!=c.hash&&(c.hash=t),this},onHashChanged:function(){}},f=t.Router=function(t){if(!(this instanceof f))return new f(t);this.params={},this.routes={},this.methods=["on","once","after","before"],this.scope=[],this._methods={},this._insert=this.insert,this.insert=this.insertEx,this.historySupport=null!=(null!=window.history?window.history.pushState:null),this.configure(),this.mount(t||{})};f.prototype.init=function(t){var e,r=this;return this.handler=function(t){var e=t&&t.newURL||window.location.hash,i=!0===r.history?r.getPath():e.replace(/.*#/,"");r.dispatch("on","/"===i.charAt(0)?i:"/"+i)},u.init(this.handler,this.history),!1===this.history?a()&&t?c.hash=t:a()||r.dispatch("on","/"+c.hash.replace(/^(#\/|#|\/)/,"")):(this.convert_hash_in_init?(e=a()&&t?t:a()?null:c.hash.replace(/^#/,""))&&window.history.replaceState({},document.title,e):e=this.getPath(),(e||!0===this.run_in_init)&&this.handler()),this},f.prototype.explode=function(){var t=!0===this.history?this.getPath():c.hash;return"/"===t.charAt(1)&&(t=t.slice(1)),t.slice(1,t.length).split("/")},f.prototype.setRoute=function(t,e,r){var i=this.explode();return"number"==typeof t&&"string"==typeof e?i[t]=e:"string"==typeof r?i.splice(t,e,s):i=[t],u.setHash(i.join("/")),i},f.prototype.insertEx=function(t,e,r,i){return"once"===t&&(t="on",r=function(t){var e=!1;return function(){if(!e)return e=!0,t.apply(this,arguments)}}(r)),this._insert(t,e,r,i)},f.prototype.getRoute=function(t){return"number"==typeof t?this.explode()[t]:"string"==typeof t?this.explode().indexOf(t):this.explode()},f.prototype.destroy=function(){return u.destroy(this.handler),this},f.prototype.getPath=function(){var t=window.location.pathname;return"/"!==t.substr(0,1)&&(t="/"+t),t};var p=/\?.*/;f.prototype.configure=function(t){t=t||{};for(var e=0;e<this.methods.length;e++)this._methods[this.methods[e]]=!0;return this.recurse=t.recurse||this.recurse||!1,this.async=t.async||!1,this.delimiter=t.delimiter||"/",this.strict=void 0===t.strict||t.strict,this.notfound=t.notfound,this.resource=t.resource,this.history=t.html5history&&this.historySupport||!1,this.run_in_init=!0===this.history&&!1!==t.run_handler_in_init,this.convert_hash_in_init=!0===this.history&&!1!==t.convert_hash_in_init,this.every={after:t.after||null,before:t.before||null,on:t.on||null},this},f.prototype.param=function(t,e){":"!==t[0]&&(t=":"+t);var r=new RegExp(t,"g");return this.params[t]=function(t){return t.replace(r,e.source||e)},this},f.prototype.on=f.prototype.route=function(t,r,i){var n=this;return!i&&"function"==typeof r&&(i=r,r=t,t="on"),Array.isArray(r)?r.forEach(function(e){n.on(t,e,i)}):(r.source&&(r=r.source.replace(/\\\//gi,"/")),Array.isArray(t)?t.forEach(function(t){n.on(t.toLowerCase(),r,i)}):(r=r.split(new RegExp(this.delimiter)),r=e(r,this.delimiter),void this.insert(t,this.scope.concat(r),i)))},f.prototype.path=function(t,r){var i=this.scope.length;t.source&&(t=t.source.replace(/\\\//gi,"/")),t=e(t=t.split(new RegExp(this.delimiter)),this.delimiter),this.scope=this.scope.concat(t),r.call(this,this),this.scope.splice(i,t.length)},f.prototype.dispatch=function(t,e,r){function i(){o.last=s.after,o.invoke(o.runlist(s),o,r)}var n,o=this,s=this.traverse(t,e.replace(p,""),this.routes,""),h=this._invoked;return this._invoked=!0,s&&0!==s.length?("forward"===this.recurse&&(s=s.reverse()),(n=this.every&&this.every.after?[this.every.after].concat(this.last):[this.last])&&n.length>0&&h?(this.async?this.invoke(n,this,i):(this.invoke(n,this),i()),!0):(i(),!0)):(this.last=[],"function"==typeof this.notfound&&this.invoke([this.notfound],{method:t,path:e},r),!1)},f.prototype.invoke=function(t,e,r){var i,o=this;this.async?(i=function(r,o){if(Array.isArray(r))return n(r,i,o);"function"==typeof r&&r.apply(e,(t.captures||[]).concat(o))},n(t,i,function(){r&&r.apply(e,arguments)})):(i=function(r){return Array.isArray(r)?h(r,i):"function"==typeof r?r.apply(e,t.captures||[]):void("string"==typeof r&&o.resource&&o.resource[r].apply(e,t.captures||[]))},h(t,i))},f.prototype.traverse=function(t,e,r,i,n){function o(t){function e(t){for(var r=t.length-1;r>=0;r--)Array.isArray(t[r])?(e(t[r]),0===t[r].length&&t.splice(r,1)):n(t[r])||t.splice(r,1)}function r(t){for(var e=[],i=0;i<t.length;i++)e[i]=Array.isArray(t[i])?r(t[i]):t[i];return e}if(!n)return t;var i=r(t);return i.matched=t.matched,i.captures=t.captures,i.after=t.after.filter(n),e(i),i}var s,h,a,c,u=[];if(e===this.delimiter&&r[t])return c=[[r.before,r[t]].filter(Boolean)],c.after=[r.after].filter(Boolean),c.matched=!0,c.captures=[],o(c);for(var f in r)if(r.hasOwnProperty(f)&&(!this._methods[f]||this._methods[f]&&"object"==typeof r[f]&&!Array.isArray(r[f]))){if(s=h=i+this.delimiter+f,this.strict||(h+="["+this.delimiter+"]?"),!(a=e.match(new RegExp("^"+h))))continue;if(a[0]&&a[0]==e&&r[f][t])return c=[[r[f].before,r[f][t]].filter(Boolean)],c.after=[r[f].after].filter(Boolean),c.matched=!0,c.captures=a.slice(1),this.recurse&&r===this.routes&&(c.push([r.before,r.on].filter(Boolean)),c.after=c.after.concat([r.after].filter(Boolean))),o(c);if((c=this.traverse(t,e,r[f],s)).matched)return c.length>0&&(u=u.concat(c)),this.recurse&&(u.push([r[f].before,r[f].on].filter(Boolean)),c.after=c.after.concat([r[f].after].filter(Boolean)),r===this.routes&&(u.push([r.before,r.on].filter(Boolean)),c.after=c.after.concat([r.after].filter(Boolean)))),u.matched=!0,u.captures=c.captures,u.after=c.after,o(u)}return!1},f.prototype.insert=function(t,e,i,n){var o,s,h,a;if(e=e.filter(function(t){return t&&t.length>0}),n=n||this.routes,a=e.shift(),/\:|\*/.test(a)&&!/\\d|\\w/.test(a)&&(a=r(a,this.params)),e.length>0)return n[a]=n[a]||{},this.insert(t,e,i,n[a]);if(a||e.length||n!==this.routes){if(o=typeof n[a],s=Array.isArray(n[a]),n[a]&&!s&&"object"==o)switch(typeof n[a][t]){case"function":return void(n[a][t]=[n[a][t],i]);case"object":return void n[a][t].push(i);case"undefined":return void(n[a][t]=i)}else if("undefined"==o)return h={},h[t]=i,void(n[a]=h);throw new Error("Invalid route context: "+o)}switch(typeof n[t]){case"function":return void(n[t]=[n[t],i]);case"object":return void n[t].push(i);case"undefined":return void(n[t]=i)}},f.prototype.extend=function(t){var e,r=this,i=t.length;for(e=0;e<i;e++)!function(t){r._methods[t]=!0,r[t]=function(){var e=1===arguments.length?[t,""]:[t];r.on.apply(r,e.concat(Array.prototype.slice.call(arguments)))}}(t[e])},f.prototype.runlist=function(t){var e=this.every&&this.every.before?[this.every.before].concat(o(t)):o(t);return this.every&&this.every.on&&e.push(this.every.on),e.captures=t.captures,e.source=t.source,e},f.prototype.mount=function(t,r){if(t&&"object"==typeof t&&!Array.isArray(t)){var i=this;r=r||[],Array.isArray(r)||(r=r.split(i.delimiter));for(var n in t)t.hasOwnProperty(n)&&function(r,n){var o=r,s=r.split(i.delimiter),h=typeof t[r],a=""===s[0]||!i._methods[s[0]],c=a?"on":o;a&&(o=o.slice((o.match(new RegExp("^"+i.delimiter))||[""])[0].length),s.shift()),a&&"object"===h&&!Array.isArray(t[r])?(n=n.concat(s),i.mount(t[r],n)):(a&&(n=n.concat(o.split(i.delimiter)),n=e(n,i.delimiter)),i.insert(c,n,t[r]))}(n,r.slice(0))}}}("object"==typeof exports?exports:window);