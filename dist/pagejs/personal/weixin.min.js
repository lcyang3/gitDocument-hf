!function(e){var i=$.dialog(),t=null,a=tools.getReqParam();animate.animateText($("header span.title"),"微信绑定","fadeIn"),$("header .header-left").addClass("hidden"),$("footer.index-list").addClass("hidden"),artTemplate.loadTemplate("","personal/weixin",{baseUrl:tools.getProjectPath()}),$("#personal-weixin .box-img img").attr("src",a.logoUrl||"./dist/images/default.png"),$("body").off("click","#personal-weixin a[data-type='submit']").on("click","#personal-weixin a[data-type='submit']",function(){t=$.dialog(),$("#personal-weixin form.personal-weixin-box").submit()}),$("body").off("click","#personal-weixin span.identifying-code:not(.disable)").on("click","#personal-weixin span.identifying-code:not(.disable)",function(){var e=this,i=$("input[data-descriptions='phone']").val();i?i.match(/^0?1[3|4|5|8][0-9]\d{8}$/)?$.ajax({url:tools.getProjectPath()+"weixin/api/getSmsCode",data:{telNum:i},success:function(i,t,a){if("0000"!=i.code)$.dialog({content:i.msg,title:"alert",time:2e3});else{$.dialog({content:"请注意查收,有效期为10分钟",title:"alert",time:2e3}),$(e).addClass("disable");var n=60,o=setInterval(function(){$(e).find("span").text("("+n--+")"),0===n&&($(e).find("span").text(""),$(e).removeClass("disable"),clearInterval(o))},1e3)}},error:function(e,i,t){$.dialog({content:"发送短信失败，请稍后重试",title:"alert",time:2e3})}}):$.fieldTooltip.show($.errorTipFormat("请输入合法手机号")):$.fieldTooltip.show($.errorTipFormat("请输入手机号"))}),$("#personal-weixin form.personal-weixin-box").mvalidate({sendForm:!1,descriptions:{name:{required:"请输入姓名",pattern:"请输入合法姓名"},certificate:{required:"请输入证件号码",pattern:"请输入合法证件号码"},phone:{required:"请输入手机号",pattern:"请输入合法手机号"},identifyingCode:{required:"请输入验证码"}},valid:function(e,i){$.ajax({url:tools.getProjectPath()+"weixin/api/bindOpenId",data:{openId:a.openId,userName:$("input[data-descriptions='name']").val(),identityType:$("select[data-descriptions='identityType']").val(),identityCard:$("input[data-descriptions='certificate']").val(),telNum:$("input[data-descriptions='phone']").val(),verifyCode:$("input[data-descriptions='identifyingCode']").val()},success:function(e,i,a){t.close(),e.code,$.dialog({content:e.msg,title:"alert",time:2e3})},error:function(e,i,a){t.close(),$.dialog({content:"绑定失败：数据请求异常",title:"alert",time:2e3})}})},invalid:function(){t.close()}}),i.close()}(hf);